# Workshop เสริมที่ 2: การเรียงลำดับข้อมูลในรายงาน (Custom Sorting)

## สถานการณ์จำลอง

ท่านได้รับ Feedback จากหัวหน้าว่าอยากเรียงลำดับหน่วยปฏิบัติตามโครงสร้างหน่วยงาน คือ ส่วนกลาง, สจป. 1-13, สจป. สาขาทุกสาขา แทนที่จะเรียงตามตัวอักษร ก-ฮ ซึ่งทำให้การอ่านรายงานยาก

## วัตถุประสงค์

1. สร้างตารางอ้างอิงลำดับหน่วยงาน
2. เรียนรู้เทคนิคการผสมข้อมูล (Data Blending) เพื่อนำลำดับมาใช้กับข้อมูลหลัก
3. จัดเรียงกราฟตามลำดับที่กำหนดเอง

## สร้างแผ่นงานอ้างอิง

เราต้องสร้าง "คู่มือ" ให้ Looker Studio รู้ว่าหน่วยงานไหนควรอยู่อันดับที่เท่าไหร่

1. สร้างแผ่นงานใหม่ใน Google Sheets ไฟล์เดิม ตั้งชื่อว่า **หน่วยปฏิบัติ**
2. สร้างคอลัมน์ 2 คอลัมน์:
    - **A1:** `ลำดับหน่วยปฏิบัติ` (สำหรับใส่ตัวเลขเรียงลำดับ)
    - **B1:** `ชื่อหน่วยปฏิบัติ` (สำหรับใส่ชื่อหน่วยงาน)
3. กรอกข้อมูลลงไป:
    - **ลำดับหน่วยปฏิบัติ:** ใส่ตัวเลข 1, 2, 3, ... ไล่ลงไป
    - **ชื่อหน่วยปฏิบัติ:** ใส่ชื่อหน่วยงานเรียงตามลำดับที่ต้องการ (เช่น 1 = ส่วนกลาง, 2 = สจป. 1, ...)

    !!! warning "ข้อควรระวัง"
        ข้อมูลในคอลัมน์ **ชื่อหน่วยปฏิบัติ** จะต้องเขียนให้ **ตรงกันทุกตัวอักษร** กับข้อมูลในแผ่นงาน Master_Data มิฉะนั้นจะไม่สามารถเชื่อมโยงข้อมูลกันได้ (แนะนำให้ใช้วิธี Copy-Paste ชื่อหน่วยงานมาวาง)

## การผสมข้อมูล (Data Blending) ใน Looker Studio

เราจะนำตาราง "หน่วยปฏิบัติ" มาเชื่อมกับ "Master_Data" เพื่อดึงเลขลำดับมาใช้

1. กลับไปที่ Looker Studio
2. เพิ่มแหล่งข้อมูลใหม่: ไปที่ **เพิ่มข้อมูล (Add data) > Google Sheets > เลือกแผ่นงาน "หน่วยปฏิบัติ" > เพิ่ม (Add)**
3. ไปที่เมนู **ทรัพยากร (Resource) > จัดการการผสมข้อมูล (Manage blends)**
4. คลิก **เพิ่มการผสม (Add a blend)**
5. ตั้งค่าการผสมข้อมูล:
    - **ตารางที่ 1 (ซ้าย):** เลือก `Master_Data`
    - **ตารางที่ 2 (ขวา):** คลิก **เข้าร่วมตารางอื่น (Join another table)** แล้วเลือกแหล่งข้อมูล `หน่วยปฏิบัติ`
6. กำหนดเงื่อนไขการเชื่อม (Join Condition):
    - ลากฟิลด์ `ชื่อหน่วยปฏิบัติ` ของทั้งสองตารางมาวางในช่อง **เงื่อนไขการเข้าร่วม (Join condition)**
    - คลิกที่สัญลักษณ์วงกลมซ้อนกัน (Join operator) เลือกเป็น **Left Outer** (เพื่อให้ข้อมูลหลักยังอยู่ครบ แม้ไม่มีลำดับระบุไว้)
    - กด **บันทึก (Save)**
7. เลือกฟิลด์ที่ต้องการใช้งาน:
    - ในตารางที่ 2 (หน่วยปฏิบัติ) ให้ลากฟิลด์ `ลำดับหน่วยปฏิบัติ` มาใส่ในช่อง **มิติข้อมูล (Dimensions)**
    - (ตรวจสอบให้แน่ใจว่าในตารางที่ 1 (Master_Data) มีฟิลด์ที่จำเป็นครบถ้วน เช่น งบประมาณ, ยอดเบิกจ่าย)
8. ตั้งชื่อการผสมข้อมูล (Data Blend Name) ด้านขวาบนว่า `Master_Data + Sorting`
9. กด **บันทึก (Save)** และ **ปิด (Close)**

## การจัดเรียงข้อมูลในแผนภูมิ

เมื่อผสมข้อมูลเสร็จแล้ว เราจะนำฟิลด์ "ลำดับหน่วยปฏิบัติ" มาใช้ในการจัดเรียง

1. คลิกที่แผนภูมิที่ต้องการจัดเรียง (เช่น กราฟแท่งแสดงหน่วยปฏิบัติ)
2. ที่แถบ **ตั้งค่า (Setup)** เปลี่ยน **แหล่งข้อมูล (Data source)** เป็น `Master_Data + Sorting` (ที่เราเพิ่งสร้าง)
3. เลื่อนลงมาที่หัวข้อ **จัดเรียง (Sort)**
4. คลิกที่ฟิลด์เดิม แล้วเปลี่ยนเป็นเลือกฟิลด์ `ลำดับหน่วยปฏิบัติ`
5. เลือกการเรียงลำดับเป็น **จากน้อยไปมาก (Ascending)**

**ผลลัพธ์:** กราฟของท่านจะเรียงลำดับหน่วยงานตามที่ท่านกำหนดไว้ใน Google Sheets อย่างถูกต้อง

## การแก้ไขปัญหา (Troubleshooting)

- **กราฟแสดงข้อมูลไม่ครบ:** อาจเกิดจากชื่อหน่วยงานใน 2 ตารางเขียนไม่ตรงกัน (เช่น มีเว้นวรรคเกิน) ให้กลับไปตรวจสอบใน Google Sheets
- **หาฟิลด์ลำดับไม่เจอ:** ให้กลับไปที่เมนู Manage blends แล้วตรวจสอบว่าได้ลากฟิลด์ `ลำดับหน่วยปฏิบัติ` เข้ามาในส่วน Dimensions แล้วหรือยัง
